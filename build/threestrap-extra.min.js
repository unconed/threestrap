THREE.Stats=function(){var e=Date.now(),t=e,i=0,n=1/0,o=0,s=0,a=1/0,r=0,c=0,h=0,l=document.createElement("div");l.id="stats",l.addEventListener("mousedown",function(e){e.preventDefault(),g(++h%2)},!1),l.style.cssText="width:80px;opacity:0.9;cursor:pointer";var d=document.createElement("div");d.id="fps",d.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",l.appendChild(d);var u=document.createElement("div");u.id="fpsText",u.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",u.innerHTML="FPS",d.appendChild(u);var p=document.createElement("div");for(p.id="fpsGraph",p.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",d.appendChild(p);74>p.children.length;){var m=document.createElement("span");m.style.cssText="width:1px;height:30px;float:left;background-color:#113",p.appendChild(m)}var v=document.createElement("div");v.id="ms",v.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",l.appendChild(v);var f=document.createElement("div");f.id="msText",f.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",f.innerHTML="MS",v.appendChild(f);var E=document.createElement("div");for(E.id="msGraph",E.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",v.appendChild(E);74>E.children.length;)m=document.createElement("span"),m.style.cssText="width:1px;height:30px;float:left;background-color:#131",E.appendChild(m);var g=function(e){switch(h=e){case 0:d.style.display="block",v.style.display="none";break;case 1:d.style.display="none",v.style.display="block"}};return{REVISION:11,domElement:l,setMode:g,begin:function(){e=Date.now()},end:function(){var h=Date.now();i=h-e,n=Math.min(n,i),o=Math.max(o,i),f.textContent=i+" MS ("+n+"-"+o+")";var l=Math.min(30,30-30*(i/200));return E.appendChild(E.firstChild).style.height=l+"px",c++,h>t+1e3&&(s=Math.round(1e3*c/(h-t)),a=Math.min(a,s),r=Math.max(r,s),u.textContent=s+" FPS ("+a+"-"+r+")",l=Math.min(30,30-30*(s/100)),p.appendChild(p.firstChild).style.height=l+"px",t=h,c=0),h},update:function(){e=this.end()}}},THREE.DeviceOrientationControls=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.freeze=!0,this.deviceOrientation={},this.screenOrientation=0;var i=function(e){t.deviceOrientation=e},n=function(){t.screenOrientation=window.orientation||0},o=function(){var e=new THREE.Vector3(0,0,1),t=new THREE.Euler,i=new THREE.Quaternion,n=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(o,s,a,r,c){t.set(a,s,-r,"YXZ"),o.setFromEuler(t),o.multiply(n),o.multiply(i.setFromAxisAngle(e,-c))}}();this.connect=function(){n(),window.addEventListener("orientationchange",n,!1),window.addEventListener("deviceorientation",i,!1),t.freeze=!1},this.disconnect=function(){t.freeze=!0,window.removeEventListener("orientationchange",n,!1),window.removeEventListener("deviceorientation",i,!1)},this.update=function(){if(!t.freeze){var e=t.deviceOrientation.gamma?THREE.Math.degToRad(t.deviceOrientation.alpha):0,i=t.deviceOrientation.beta?THREE.Math.degToRad(t.deviceOrientation.beta):0,n=t.deviceOrientation.gamma?THREE.Math.degToRad(t.deviceOrientation.gamma):0,s=t.screenOrientation?THREE.Math.degToRad(t.screenOrientation):0;o(t.object.quaternion,e,i,n,s)}}},THREE.FirstPersonControls=function(e,t){function i(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.target=new THREE.Vector3(0,0,0),this.domElement=void 0!==t?t:document,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.freeze=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.update=function(e){if(!this.freeze){if(this.heightSpeed){var t=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax),i=t-this.heightMin;this.autoSpeedFactor=e*i*this.heightCoef}else this.autoSpeedFactor=0;var n=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(n+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(n),this.moveLeft&&this.object.translateX(-n),this.moveRight&&this.object.translateX(n),this.moveUp&&this.object.translateY(n),this.moveDown&&this.object.translateY(-n);var o=e*this.lookSpeed;this.activeLook||(o=0);var s=1;this.constrainVertical&&(s=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*o,this.lookVertical&&(this.lat-=this.mouseY*o*s),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=THREE.Math.degToRad(90-this.lat),this.theta=THREE.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax));var a=this.target,r=this.object.position;a.x=r.x+100*Math.sin(this.phi)*Math.cos(this.theta),a.y=r.y+100*Math.cos(this.phi),a.z=r.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(a)}},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",i(this,this.onMouseMove),!1),this.domElement.addEventListener("mousedown",i(this,this.onMouseDown),!1),this.domElement.addEventListener("mouseup",i(this,this.onMouseUp),!1),this.domElement.addEventListener("keydown",i(this,this.onKeyDown),!1),this.domElement.addEventListener("keyup",i(this,this.onKeyUp),!1),this.handleResize()},THREE.OrbitControls=function(e,t){function i(){return 2*Math.PI/60/60*u.autoRotateSpeed}function n(){return Math.pow(.95,u.zoomSpeed)}function o(e){if(u.enabled!==!1){if(e.preventDefault(),0===e.button){if(u.noRotate===!0)return;D=O.ROTATE,m.set(e.clientX,e.clientY)}else if(1===e.button){if(u.noZoom===!0)return;D=O.DOLLY,R.set(e.clientX,e.clientY)}else if(2===e.button){if(u.noPan===!0)return;D=O.PAN,E.set(e.clientX,e.clientY)}u.domElement.addEventListener("mousemove",s,!1),u.domElement.addEventListener("mouseup",a,!1),u.dispatchEvent(F)}}function s(e){if(u.enabled!==!1){e.preventDefault();var t=u.domElement===document?u.domElement.body:u.domElement;if(D===O.ROTATE){if(u.noRotate===!0)return;v.set(e.clientX,e.clientY),f.subVectors(v,m),u.rotateLeft(2*Math.PI*f.x/t.clientWidth*u.rotateSpeed),u.rotateUp(2*Math.PI*f.y/t.clientHeight*u.rotateSpeed),m.copy(v)}else if(D===O.DOLLY){if(u.noZoom===!0)return;T.set(e.clientX,e.clientY),k.subVectors(T,R),k.y>0?u.dollyIn():u.dollyOut(),R.copy(T)}else if(D===O.PAN){if(u.noPan===!0)return;g.set(e.clientX,e.clientY),b.subVectors(g,E),u.pan(b.x,b.y),E.copy(g)}u.update()}}function a(){u.enabled!==!1&&(u.domElement.removeEventListener("mousemove",s,!1),u.domElement.removeEventListener("mouseup",a,!1),u.dispatchEvent(j),D=O.NONE)}function r(e){if(u.enabled!==!1&&u.noZoom!==!0){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?u.dollyOut():u.dollyIn(),u.update(),u.dispatchEvent(F),u.dispatchEvent(j)}}function c(e){if(u.enabled!==!1&&u.noKeys!==!0&&u.noPan!==!0)switch(e.keyCode){case u.keys.UP:u.pan(0,u.keyPanSpeed),u.update();break;case u.keys.BOTTOM:u.pan(0,-u.keyPanSpeed),u.update();break;case u.keys.LEFT:u.pan(u.keyPanSpeed,0),u.update();break;case u.keys.RIGHT:u.pan(-u.keyPanSpeed,0),u.update()}}function h(e){if(u.enabled!==!1){switch(e.touches.length){case 1:if(u.noRotate===!0)return;D=O.TOUCH_ROTATE,m.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(u.noZoom===!0)return;D=O.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);R.set(0,n);break;case 3:if(u.noPan===!0)return;D=O.TOUCH_PAN,E.set(e.touches[0].pageX,e.touches[0].pageY);break;default:D=O.NONE}u.dispatchEvent(F)}}function l(e){if(u.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=u.domElement===document?u.domElement.body:u.domElement;switch(e.touches.length){case 1:if(u.noRotate===!0)return;if(D!==O.TOUCH_ROTATE)return;v.set(e.touches[0].pageX,e.touches[0].pageY),f.subVectors(v,m),u.rotateLeft(2*Math.PI*f.x/t.clientWidth*u.rotateSpeed),u.rotateUp(2*Math.PI*f.y/t.clientHeight*u.rotateSpeed),m.copy(v),u.update();break;case 2:if(u.noZoom===!0)return;if(D!==O.TOUCH_DOLLY)return;var i=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(i*i+n*n);T.set(0,o),k.subVectors(T,R),k.y>0?u.dollyOut():u.dollyIn(),R.copy(T),u.update();break;case 3:if(u.noPan===!0)return;if(D!==O.TOUCH_PAN)return;g.set(e.touches[0].pageX,e.touches[0].pageY),b.subVectors(g,E),u.pan(b.x,b.y),E.copy(g),u.update();break;default:D=O.NONE}}}function d(){u.enabled!==!1&&(u.dispatchEvent(j),D=O.NONE)}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var u=this,p=1e-6,m=new THREE.Vector2,v=new THREE.Vector2,f=new THREE.Vector2,E=new THREE.Vector2,g=new THREE.Vector2,b=new THREE.Vector2,y=new THREE.Vector3,w=new THREE.Vector3,R=new THREE.Vector2,T=new THREE.Vector2,k=new THREE.Vector2,x=0,H=0,M=1,V=new THREE.Vector3,L=new THREE.Vector3,O={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},D=O.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone();var C=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),P=C.clone().inverse(),S={type:"change"},F={type:"start"},j={type:"end"};this.rotateLeft=function(e){void 0===e&&(e=i()),H-=e},this.rotateUp=function(e){void 0===e&&(e=i()),x-=e},this.panLeft=function(e){var t=this.object.matrix.elements;y.set(t[0],t[1],t[2]),y.multiplyScalar(-e),V.add(y)},this.panUp=function(e){var t=this.object.matrix.elements;y.set(t[4],t[5],t[6]),y.multiplyScalar(e),V.add(y)},this.pan=function(e,t){var i=u.domElement===document?u.domElement.body:u.domElement;if(void 0!==u.object.fov){var n=u.object.position,o=n.clone().sub(u.target),s=o.length();s*=Math.tan(u.object.fov/2*Math.PI/180),u.panLeft(2*e*s/i.clientHeight),u.panUp(2*t*s/i.clientHeight)}else void 0!==u.object.top?(u.panLeft(e*(u.object.right-u.object.left)/i.clientWidth),u.panUp(t*(u.object.top-u.object.bottom)/i.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=n()),M/=e},this.dollyOut=function(e){void 0===e&&(e=n()),M*=e},this.update=function(){var e=this.object.position;w.copy(e).sub(this.target),w.applyQuaternion(C);var t=Math.atan2(w.x,w.z),n=Math.atan2(Math.sqrt(w.x*w.x+w.z*w.z),w.y);this.autoRotate&&this.rotateLeft(i()),t+=H,n+=x,n=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,n)),n=Math.max(p,Math.min(Math.PI-p,n));var o=w.length()*M;o=Math.max(this.minDistance,Math.min(this.maxDistance,o)),this.target.add(V),w.x=o*Math.sin(n)*Math.sin(t),w.y=o*Math.cos(n),w.z=o*Math.sin(n)*Math.cos(t),w.applyQuaternion(P),e.copy(this.target).add(w),this.object.lookAt(this.target),H=0,x=0,M=1,V.set(0,0,0),L.distanceToSquared(this.object.position)>p&&(this.dispatchEvent(S),L.copy(this.object.position))},this.reset=function(){D=O.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.update()},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",o,!1),this.domElement.addEventListener("mousewheel",r,!1),this.domElement.addEventListener("DOMMouseScroll",r,!1),this.domElement.addEventListener("touchstart",h,!1),this.domElement.addEventListener("touchend",d,!1),this.domElement.addEventListener("touchmove",l,!1),window.addEventListener("keydown",c,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.VRControls=function(e,t){var i=1e-5,n=this.dummy=new THREE.Object3D;this.object=e,this.device=new THREE.DeviceOrientationControls(n,t),this.orbit=new THREE.OrbitControls(n,t),this.orbit.target.copy(e.position),this.orbit.target.z+=i,this.orbit.rotateSpeed=-.25,this.supported=!1;var o=function(e){this.supported=e&&e.alpha==+e.alpha,window.removeEventListener("deviceorientation",o,!1)}.bind(this);window.addEventListener("deviceorientation",o,!1)},THREE.VRControls.prototype.vr=function(e){this.vrstate=e},THREE.VRControls.prototype.update=function(e){var t=!1;this.vrstate&&this.vrstate.orientation?(t=!0,this.object.quaternion.copy(this.vrstate.orientation),this.object.position.copy(this.vrstate.position),this.device.object=this.dummy,this.orbit.object=this.dummy):this.vrstate&&this.supported?(this.device.freeze&&this.device.connect(),this.device.object=this.object,this.orbit.object=this.dummy,this.device.update(e)):(t=!0,this.device.object=this.dummy,this.orbit.object=this.object,this.orbit.update(e)),t&&!this.device.freeze&&this.device.disconnect()},THREE.Bootstrap.registerPlugin("stats",{listen:["pre","post"],install:function(e){var t=this.stats=new THREE.Stats,i=t.domElement.style;i.position="absolute",i.top=i.left=0,e.element.appendChild(t.domElement),e.stats=t},uninstall:function(e){document.body.removeChild(this.stats.domElement),delete e.stats},pre:function(){this.stats.begin()},post:function(){this.stats.end()}}),THREE.Bootstrap.registerPlugin("controls",{listen:["update","resize","camera","this.change"],defaults:{klass:null,parameters:{}},install:function(e){if(!this.options.klass)throw"Must provide class for `controls.klass`";e.controls=null,this._camera=e.camera||new THREE.PerspectiveCamera,this.change(null,e)},uninstall:function(e){delete e.controls},change:function(e,t){this.options.klass?((!e||e.changes.klass)&&(t.controls=new this.options.klass(this._camera,t.renderer.domElement)),_.extend(t.controls,this.options.parameters)):t.controls=null},update:function(e,t){var i=t.Time&&t.Time.delta||1/60,n=t.VR&&t.VR.state;t.controls.vr&&t.controls.vr(n),t.controls.update(i)},camera:function(e,t){t.controls.object=this._camera=e.camera},resize:function(e,t){t.controls.handleResize&&t.controls.handleResize()}}),THREE.Bootstrap.registerPlugin("cursor",{listen:["update","this.change","install:change","uninstall:change","element.mousemove","vr"],defaults:{cursor:null,hide:!1,timeout:3},install:function(e){this.timeout=this.options.timeout,this.element=e.element,this.change(null,e)},uninstall:function(e){delete e.controls},change:function(e,t){this.applyCursor(t)},mousemove:function(e,t){this.options.hide&&(this.applyCursor(t),this.timeout=+this.options.timeout||0)},update:function(e,t){var i=t.Time&&t.Time.delta||1/60;this.options.hide&&(this.timeout-=i,this.timeout<0&&this.applyCursor(t,"none"))},vr:function(e,t){this.hide=e.active&&!e.hmd.fake,this.applyCursor(t)},applyCursor:function(e,t){var i=e.controls?"move":"";t=t||this.options.cursor||i,this.hide&&(t="none"),this.cursor!=t&&(this.element.style.cursor=t)}}),THREE.Bootstrap.registerPlugin("fullscreen",{defaults:{key:"f"},listen:["ready","update"],install:function(e){e.Fullscreen=this.api({active:!1,toggle:this.toggle.bind(this)},e)},uninstall:function(e){delete e.Fullscreen},ready:function(e,t){document.body.addEventListener("keypress",function(e){this.options.key&&e.charCode==this.options.key.charCodeAt(0)&&this.toggle(t)}.bind(this));var i=function(){var e=!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);t.Fullscreen.active=this.active=e,t.trigger({type:"fullscreen",active:e})}.bind(this);document.addEventListener("fullscreenchange",i,!1),document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1)},toggle:function(e){var t=e.canvas,i=e.VR&&e.VR.active?{vrDisplay:e.VR.hmd}:{};this.active?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen():t.requestFullScreen?t.requestFullScreen(i):t.msRequestFullScreen?t.msRequestFullscreen(i):t.webkitRequestFullscreen?t.webkitRequestFullscreen(i):t.mozRequestFullScreen&&t.mozRequestFullScreen(i)}}),THREE.Bootstrap.registerPlugin("vr",{defaults:{mode:"auto",device:null},listen:["window.load","pre","render","this.change"],install:function(e){e.VR=this.api({active:!1,devices:[],hmd:null,sensor:null,renderer:null,state:null},e)},uninstall:function(e){delete e.VR},mocks:function(e){var t=e.aspect,i=e.fov,n=360*Math.atan(Math.tan(i*Math.PI/360)*t/2)/Math.PI,o=i,s=function(e){return{left:{x:-.03,y:0,z:0},right:{x:.03,y:0,z:0}}[e]},a=function(e){return{left:{rightDegrees:n,leftDegrees:n,downDegrees:o,upDegrees:o},right:{rightDegrees:n,leftDegrees:n,downDegrees:o,upDegrees:o}}[e]},r=function(){return{}};return[{fake:!0,force:1,deviceId:"emu",deviceName:"Emulated",getEyeTranslation:s,getRecommendedEyeFieldOfView:a},{force:2,getState:r}]},load:function(e,t){var i=function(e){this.callback(e,t)}.bind(this);navigator.getVRDevices?navigator.getVRDevices().then(i):navigator.mozGetVRDevices?navigator.mozGetVRDevices(i):(console.warn("No native VR support detected."),i(this.mocks(t.camera),t))},callback:function(e,t){var i,n,o=window.HMDVRDevice||function(){},s=window.PositionSensorVRDevice||function(){};e=t.VR.devices=e||t.VR.devices;for(var a=this.options.device,r=0;r<e.length;++r){var c=e[r];if(1==c.force||c instanceof o){if(a&&a!=c.deviceId)continue;i=c;break}}if(i){for(var r=0;r<e.length;++r){var c=e[r];if(2==c.force||c instanceof s&&c.hardwareUnitId==i.hardwareUnitId){n=c;break}}this.hookup(i,n,t)}},hookup:function(e,t,i){THREE.VRRenderer||console.log("THREE.VRRenderer not found");var n=THREE.VRRenderer||function(){};this.renderer=new n(i.renderer,e),this.hmd=e,this.sensor=t,i.VR.renderer=this.renderer,i.VR.hmd=e,i.VR.sensor=t,console.log("THREE.VRRenderer",e.deviceName)},change:function(e,t){e.changes.device&&this.callback(null,t),this.pre(e,t)},pre:function(e,t){var i=this.active,n=this.active=this.renderer&&"2d"!=this.options.mode;if(t.VR.active=n,n&&this.sensor){var o=this.sensor.getState();t.VR.state=o}else t.VR.state=null;i!=this.active&&t.trigger({type:"vr",active:n,hmd:this.hmd,sensor:this.sensor})},render:function(e,t){if(t.scene&&t.camera){var i=this.active?this.renderer:t.renderer;if(this.last!=i&&i==t.renderer){var n=i.devicePixelRatio,o=i.domElement.width/n,s=i.domElement.height/n;i.enableScissorTest(!1),i.setViewport(0,0,o,s)}this.last=i,i.render(t.scene,t.camera)}}}),THREE.Bootstrap.registerPlugin("ui",{defaults:{theme:"white",style:".threestrap-ui { position: absolute; bottom: 5px; right: 5px; float: left; }.threestrap-ui button { border: 0; background: none;  vertical-align: middle; font-weight: bold; } .threestrap-ui .glyphicon { top: 2px; font-weight: bold; } @media (max-width: 640px) { .threestrap-ui button { font-size: 120% } }.threestrap-white button { color: #fff; text-shadow: 0 1px 1px rgba(0, 0, 0, 1), 0 1px 3px rgba(0, 0, 0, 1); }.threestrap-black button { color: #000; text-shadow: 0 0px 1px rgba(255, 255, 255, 1), 0 0px 2px rgba(255, 255, 255, 1), 0 0px 2px rgba(255, 255, 255, 1) }"},listen:["fullscreen"],markup:function(e,t,i){var n="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css",o=[];return e.Fullscreen&&o.push('<button class="fullscreen" title="Full Screen"><span class="glyphicon glyphicon-fullscreen"></span></button>'),e.VR&&o.push('<button class="vr" title="VR Headset">VR</button>'),'<style type="text/css">@import url("'+n+'"); '+i+'</style><div class="threestrap-ui threestrap-'+t+'">'+o.join("\n")+"</div>"},install:function(e){var t=this.ui=document.createElement("div");t.innerHTML=this.markup(e,this.options.theme,this.options.style),document.body.appendChild(t);var i=this.ui.fullscreen=t.querySelector("button.fullscreen");i&&e.bind([i,"click:goFullscreen"],this);var n=this.ui.vr=t.querySelector("button.vr");n&&(e.VR.set({mode:"2d"}),e.bind([n,"click:goVR"],this))},uninstall:function(){document.body.removeChild(ui)},fullscreen:function(e,t){this.ui.style.display=e.active?"none":"block",e.active||t.VR.set({mode:"2d"})},goFullscreen:function(e,t){t.Fullscreen&&t.Fullscreen.toggle()},goVR:function(e,t){t.VR&&(t.VR.set({mode:"auto"}),t.Fullscreen.toggle())},uninstall:function(){document.body.removeChild(this.ui)}});