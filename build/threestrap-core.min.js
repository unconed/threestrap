THREE.Binder={bind:function(t,e){return function(i,n){n.__binds||(n.__binds=[]);var s=t;_.isArray(i)&&(s=i[0],i=i[1]);for(var r=/^([^.:]*(?:\.[^.:]+)*)?(?:\:(.*))?$/.exec(i),a=r[1].split(/\./g),l=a.pop(),o=r[2]||l,h=a.shift(),d={"this":n}[h]||e[h]||t[h]||s;d&&(i=a.shift());)d=d[i];if(d&&(d.on||d.addEventListener)){var u=function(e){n[o]&&n[o](e,t)};THREE.Binder._polyfill(d,["addEventListener","on"],function(t){d[t](l,u)});var p={target:d,name:l,callback:u};return n.__binds.push(p),u}throw"Cannot bind '"+i+"' in "+this.__name}},unbind:function(){return function(t){t.__binds&&(t.__binds.forEach(function(t){THREE.Binder._polyfill(t.target,["removeEventListener","off"],function(e){t.target[e](t.name,t.callback)})}.bind(this)),t.__binds=[])}},apply:function(t){THREE.EventDispatcher.prototype.apply(t),t.trigger=THREE.Binder._trigger,t.triggerOnce=THREE.Binder._triggerOnce,t.on=t.addEventListener,t.off=t.removeEventListener,t.dispatchEvent=t.trigger},_triggerOnce:function(t){this.trigger(t),this._listeners&&delete this._listeners[t.type]},_trigger:function(t){if(void 0!==this._listeners){var e=t.type,i=this._listeners[e];if(void 0!==i){i=i.slice();var n=i.length;t.target=this;for(var s=0;n>s;s++)i[s].call(this,t,this)}}},_polyfill:function(t,e,i){e.map(function(){return t.method}),e.length&&i(e[0])}},THREE.Api={apply:function(t){t.set=function(t){var e=this.options||{},i=_.reduce(t,function(t,i,n){return e[n]!==i&&(t[n]=i),t},{});this.options=_.extend(e,i),this.trigger({type:"change",options:t,changes:i})},t.get=function(){return this.options},t.api=function(t,e){return t=t||{},e&&_.each(t,function(t,i,n){_.isFunction(t)&&(n[i]=_.partialRight(t,e))}),t.set=this.set.bind(this),t.get=this.get.bind(this),t}}},THREE.Bootstrap=function(t){if(t){var e=[].slice.apply(arguments);t={},e[0]instanceof Node&&(node=e[0],e=e.slice(1),t.element=node),_.isString(e[0])&&(t.plugins=e),_.isArray(e[0])&&(t.plugins=e[0]),e[0]&&(t=_.defaults(t,e[0]))}if(!(this instanceof THREE.Bootstrap))return new THREE.Bootstrap(t);var i={init:!0,element:document.body,plugins:["core"],aliases:{},plugindb:THREE.Bootstrap.Plugins||{},aliasdb:THREE.Bootstrap.Aliases||{}};this.__options=_.defaults(t||{},i),this.__inited=!1,this.__destroyed=!1,this.__installed=[];var n=this.__options.element;n===""+n&&(n=document.querySelector(n)),this.plugins={},this.element=n,this.__options.init&&this.init()},THREE.Bootstrap.prototype={init:function(){return this.__inited?void 0:(this.__inited=!0,this.install(this.__options.plugins),this)},destroy:function(){return this.__inited&&!this.__destroyed?(this.__destroyed=!0,this.trigger({type:"destroy"}),this.uninstall(),this):void 0},resolve:function(t){function e(t,i,r){if(r>=256)throw"Plug-in alias recursion detected.";return t=_.filter(t,s),_.each(t,function(t){var s=n[t];s?i=i.concat(e(s,[],r+1)):i.push(t)}),i}t=_.isArray(t)?t:[t];var i=this.__options,n=_.extend({},i.aliasdb,i.aliases),s=function(t){var e=t.split(":");return e[1]?(n[e[0]]=[e[1]],!1):!0};return t=_.filter(t,s),_.each(n,function(t,e){n[e]=_.isArray(t)?t:[t]}),e(t,[],0)},install:function(t){t=_.isArray(t)?t:[t],t=this.resolve(t),_.each(t,this.__install,this),this.__ready()},uninstall:function(t){t&&(t=_.isArray(t)?t:[t],t=this.resolve(t)),_.eachRight(t||this.__installed,this.__uninstall,this)},__install:function(t){var e=this.__options.plugindb[t];if(!e)throw"[three.install] Cannot install. '"+t+"' is not registered.";if(this.plugins[t])return console.warn("[three.install] "+t+" is already installed.");var i=e,n=new i(this.__options[t]||{},t);return this.plugins[t]=n,flag=n.install(this),this.__installed.push(n),this.trigger({type:"install",plugin:n}),flag},__uninstall:function(t){return(plugin=_.isString(t)?this.plugins[t]:t)?(t=plugin.__name,plugin.uninstall(this),this.__installed=_.without(this.__installed,plugin),delete this.plugins[t],void this.trigger({type:"uninstall",plugin:plugin})):console.warn("[three.uninstall] "+t+"' is not installed.")},__ready:function(){this.triggerOnce({type:"ready"})}},THREE.Binder.apply(THREE.Bootstrap.prototype),THREE.Bootstrap.Plugins={},THREE.Bootstrap.Aliases={},THREE.Bootstrap.Plugin=function(t){this.options=_.defaults(t||{},this.defaults)},THREE.Bootstrap.Plugin.prototype={listen:[],defaults:{},install:function(){},uninstall:function(){}},THREE.Binder.apply(THREE.Bootstrap.Plugin.prototype),THREE.Api.apply(THREE.Bootstrap.Plugin.prototype),THREE.Bootstrap.registerPlugin=function(t,e){var i=function(e){THREE.Bootstrap.Plugin.call(this,e),this.__name=t};i.prototype=_.extend(new THREE.Bootstrap.Plugin,e),THREE.Bootstrap.Plugins[t]=i},THREE.Bootstrap.unregisterPlugin=function(t){delete THREE.Bootstrap.Plugins[t]},THREE.Bootstrap.registerAlias=function(t,e){THREE.Bootstrap.Aliases[t]=e},THREE.Bootstrap.unregisterAlias=function(t){delete THREE.Bootstrap.Aliases[t]},THREE.Bootstrap.registerAlias("empty",["fallback","bind","renderer","size","fill","loop","time"]),THREE.Bootstrap.registerAlias("core",["empty","scene","camera","render","warmup"]),THREE.Bootstrap.registerAlias("VR",["core","cursor","fullscreen","render:vr"]),THREE.Bootstrap.registerPlugin("fallback",{defaults:{force:!1,fill:!0,begin:'<div class="threestrap-fallback" style="display: table; width: 100%; height: 100%;box-sizing: border-box; border: 1px dashed rgba(0, 0, 0, .25);"><div style="display: table-cell; padding: 10px; vertical-align: middle; text-align: center;">',end:"</div></div>",message:'<big><strong>This example requires WebGL</strong></big><br>Visit <a target="_blank" href="http://get.webgl.org/">get.webgl.org</a> for more info</a>'},install:function(t){var e;try{if(e=document.createElement("canvas"),gl=e.getContext("webgl")||e.getContext("experimental-webgl"),!gl||this.options.force)throw"WebGL unavailable.";t.fallback=!1}catch(i){var n=this.options.message,s=this.options.begin,r=this.options.end,a=this.options.fill,l=document.createElement("div");for(l.innerHTML=s+n+r,this.children=[];l.childNodes.length>0;)this.children.push(l.firstChild),t.element.appendChild(l.firstChild);return a&&t.install("fill"),this.div=l,t.fallback=!0,!1}},uninstall:function(t){this.children&&(this.children.forEach(function(t){t.parentNode.removeChild(t)}),this.children=null),delete t.fallback}}),THREE.Bootstrap.registerPlugin("renderer",{defaults:{klass:THREE.WebGLRenderer,parameters:{depth:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!0}},listen:["resize"],install:function(t){var e=t.renderer=new this.options.klass(this.options.parameters);t.canvas=e.domElement,t.element.appendChild(e.domElement)},uninstall:function(t){t.element.removeChild(t.renderer.domElement),delete t.renderer,delete t.canvas},resize:function(t,e){var i=e.renderer,n=i.domElement;n&&"CANVAS"==n.tagName?i.setSize(t.renderWidth,t.renderHeight,!1):(i.setRenderSize&&i.setRenderSize(t.renderWidth,t.renderHeight),i.setSize(t.viewWidth,t.viewHeight,!1))}}),THREE.Bootstrap.registerPlugin("bind",{install:function(t){var e={three:t,window:window};t.bind=THREE.Binder.bind(t,e),t.unbind=THREE.Binder.unbind(t),t.bind("install:bind",this),t.bind("uninstall:unbind",this)},uninstall:function(t){t.unbind(this),delete t.bind,delete t.unbind},bind:function(t,e){var i=t.plugin,n=i.listen;n&&n.forEach(function(t){e.bind(t,i)})},unbind:function(t,e){e.unbind(t.plugin)}}),THREE.Bootstrap.registerPlugin("size",{defaults:{width:null,height:null,aspect:null,scale:1,maxRenderWidth:1/0,maxRenderHeight:1/0,devicePixelRatio:!0},listen:["window.resize:queue","element.resize:queue","this.change:queue","ready:resize","pre:pre"],install:function(t){t.Size=this.api({renderWidth:0,renderHeight:0,viewWidth:0,viewHeight:0}),this.resized=!1},uninstall:function(t){delete t.Size},queue:function(){this.resized=!0},pre:function(t,e){this.resized&&(this.resized=!1,this.resize(t,e))},resize:function(t,e){var i,n,s,r,a,l,o,h,d,u=this.options,p=e.element,c=e.renderer,g=0,f=0;i=s=void 0===u.width||null==u.width?p.offsetWidth||p.innerWidth||0:u.width,n=r=void 0===u.height||null==u.height?p.offsetHeight||p.innerHeight||0:u.height,o=i/n,u.aspect&&(u.aspect>o?(n=Math.round(i/u.aspect),f=Math.floor((r-n)/2)):(i=Math.round(n*u.aspect),g=Math.floor((s-i)/2)),o=i/n),d=1,u.devicePixelRatio&&"undefined"!=typeof window&&(d=window.devicePixelRatio||1),a=Math.min(i*d*u.scale,u.maxRenderWidth),l=Math.min(n*d*u.scale,u.maxRenderHeight),raspect=a/l,raspect>o?a=Math.round(l*o):l=Math.round(a/o),d=l/n,h=c.domElement.style,h.width=i+"px",h.height=n+"px",h.marginLeft=g+"px",h.marginTop=f+"px",_.extend(e.Size,{renderWidth:a,renderHeight:l,viewWidth:i,viewHeight:n,aspect:o,pixelRatio:d}),e.trigger({type:"resize",renderWidth:a,renderHeight:l,viewWidth:i,viewHeight:n,aspect:o,pixelRatio:d})}}),THREE.Bootstrap.registerPlugin("fill",{defaults:{block:!0,body:!0,layout:!0},install:function(t){function e(t){var e=t.style.height;return"auto"==e||""==e}function i(t){return t.style.height="100%",t.style.margin=0,t.style.padding=0,t}if(this.options.body&&t.element==document.body&&(this.applied=[t.element,document.documentElement].filter(e).map(i)),this.options.block&&t.canvas&&(t.canvas.style.display="block",this.block=!0),this.options.layout&&t.element){var n=window.getComputedStyle(t.element);"static"==n.position&&(t.element.style.position="relative",this.layout=!0)}},uninstall:function(t){function e(t){return t.style.height="",t.style.margin="",t.style.padding="",t}this.applied&&(this.applied.map(e),delete this.applied),this.block&&t.canvas&&(t.canvas.style.display="",delete this.block),this.layout&&t.element&&(t.element.style.position="",delete this.layout)},change:function(t){this.uninstall(t),this.install(t)}}),THREE.Bootstrap.registerPlugin("loop",{defaults:{start:!0},listen:["ready"],install:function(t){this.running=!1,t.Loop=this.api({start:this.start.bind(this),stop:this.stop.bind(this),running:!1},t),this.events=["pre","update","render","post"].map(function(t){return{type:t}})},uninstall:function(t){this.stop(t)},ready:function(t,e){this.options.start&&this.start(e)},start:function(t){if(!this.running){t.Loop.running=this.running=!0;var e=t.trigger.bind(t),i=function(){this.running&&requestAnimationFrame(i),this.events.map(e)}.bind(this);requestAnimationFrame(i),t.trigger({type:"start"})}},stop:function(t){this.running&&(t.Loop.running=this.running=!1,t.trigger({type:"stop"}))}}),THREE.Bootstrap.registerPlugin("time",{defaults:{speed:1,warmup:0,timeout:1},listen:["pre:tick","this.change"],now:function(){return+new Date/1e3},install:function(t){t.Time=this.api({now:this.now(),clock:0,step:1/60,frames:0,time:0,delta:1/60,average:0,fps:0}),this.last=0,this.time=0,this.clock=0,this.wait=this.options.warmup,this.clockStart=0,this.timeStart=0},tick:function(t,e){var i=this.options.speed,n=this.options.timeout,s=e.Time,r=s.now=this.now(),a=this.last,l=this.time,o=this.clock;if(a){var h=s.delta=r-a,d=s.average||h;h>n&&(h=0);var u=h*i;l+=h,o+=u,s.frames>0&&(s.average=d+.1*(h-d),s.fps=1/d),s.step=u,s.clock=o-this.clockStart,s.time=l-this.timeStart,s.frames++,this.wait-->0&&(this.clockStart=o,this.timeStart=l,s.clock=0,s.step=1e-100)}this.last=r,this.clock=o,this.time=l},uninstall:function(t){delete t.Time}}),THREE.Bootstrap.registerPlugin("scene",{install:function(t){t.scene=new THREE.Scene},uninstall:function(t){delete t.scene}}),THREE.Bootstrap.registerPlugin("camera",{defaults:{near:.01,far:1e4,type:"perspective",fov:60,aspect:null,left:-1,right:1,bottom:-1,top:1,klass:null,parameters:null},listen:["resize","this.change"],install:function(t){t.Camera=this.api(),t.camera=null,this.aspect=1,this.change({},t)},uninstall:function(t){delete t.Camera,delete t.camera},change:function(t,e){var i=this.options,n=e.camera;if(!e.camera||t.changes.type||t.changes.klass){var s=i.klass||{perspective:THREE.PerspectiveCamera,orthographic:THREE.OrthographicCamera}[i.type]||THREE.Camera;e.camera=i.parameters?new s(i.parameters):new s}_.each(i,function(t,n){e.camera.hasOwnProperty(n)&&(e.camera[n]=i[n])}.bind(this)),this.update(e),n===e.camera||e.trigger({type:"camera",camera:e.camera})},resize:function(t,e){this.aspect=t.viewWidth/Math.max(1,t.viewHeight),this.update(e)},update:function(t){t.camera.aspect=this.options.aspect||this.aspect,t.camera.updateProjectionMatrix()}}),THREE.Bootstrap.registerPlugin("render",{listen:["render"],render:function(t,e){e.scene&&e.camera&&e.renderer.render(e.scene,e.camera)}}),THREE.Bootstrap.registerPlugin("warmup",{defaults:{delay:2},listen:["ready","post"],ready:function(t,e){e.renderer.domElement.style.visibility="hidden",this.frame=0,this.hidden=!0},post:function(t,e){this.hidden&&this.frame>=this.options.delay&&(e.renderer.domElement.style.visibility="visible",this.hidden=!1),this.frame++}});